<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}Mi aplicación Flask{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <style>
      #map {
        width: 100%;
        height: 90vh; /* Ocupa toda la altura de la ventana */
        position: relative;
      }

      #top-controls {
        top: 7rem;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        background: rgba(255, 255, 255, 0.9);
        padding: 0.5rem 1rem;
        border-radius: 4px;
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.2);
      }

      .leaflet-container {
        margin-top: 6rem; /* o ajusta según la altura real de tu navbar */
      }

      .navbar .nav-link {
        color: #ffffff; /* blanco puro */
        font-weight: bold;
      }

      /* Estilo para cuando el mouse pasa por encima */
      .navbar .nav-link:hover {
        color: #a8f0a0 !important; /* un verde clarito opcional */
      }

      /* Enlace activo (ya lo tenías definido) */
      .active-link {
        color: #28a745 !important; /* verde */
        font-weight: bold;
      }

      /* Estilos dinámicos para las etiquetas de parroquias según el zoom */
      .parroquia-label {
        font-size: 9px;
        transition: font-size 0.2s ease, opacity 0.2s ease;
        text-shadow: 1px 1px 2px white, -1px -1px 2px white, 1px -1px 2px white, -1px 1px 2px white;
      }
    </style>
  </head>

  <body>
    <!-- Navbar fija en la parte superior -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>

      <div
        class="collapse navbar-collapse justify-content-center"
        id="navbarNav"
      >
        <ul class="navbar-nav text-center">
          <li class="nav-item mx-3">
            <a
              class="nav-link {% if ruta_activa == 'rurales' %}active-link{% endif %}"
              href="/"
              >Parroquias Rurales</a
            >
          </li>
          <li class="nav-item mx-3">
            <a
              class="nav-link {% if ruta_activa == 'urbanas' %}active-link{% endif %}"
              href="/urbanas"
              >Parroquias Urbanas</a
            >
          </li>
        </ul>
      </div>
    </nav>

    <!-- Contenedor general para el contenido -->
    <div class="container-fluid">{% block content %} {% endblock %}</div>

    <!-- Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

    {% block scripts %}{% endblock %}

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const mapObj = window["{{ map_name }}"];

        if (mapObj) {
          //mapObj.scrollWheelZoom.disable();  // desactiva zoom con rueda
          //mapObj.dragging.disable();         // desactiva movimiento
          //mapObj.zoomControl.remove();       // oculta botones de zoom

          // Función para ajustar el tamaño de fuente según el zoom
          function ajustarTamañoFuente() {
            const zoom = mapObj.getZoom();
            let fontSize;
            let opacity = 1;
            
            // Escala más agresiva de tamaños de fuente
            if (zoom < 9) {
              fontSize = 0; // Ocultar completamente en zoom muy bajo
              opacity = 0;
            } else if (zoom < 10) {
              fontSize = 4; // Muy pequeño
              opacity = 0.7;
            } else if (zoom < 11) {
              fontSize = 5;
              opacity = 0.85;
            } else if (zoom < 12) {
              fontSize = 7;
              opacity = 1;
            } else if (zoom < 13) {
              fontSize = 9;
            } else if (zoom < 14) {
              fontSize = 11;
            } else if (zoom < 15) {
              fontSize = 13;
            } else {
              fontSize = 15; // Máximo para zoom alto
            }

            // Aplicar el nuevo tamaño a todas las etiquetas
            const labels = document.querySelectorAll(".parroquia-label");
            labels.forEach((label) => {
              label.style.fontSize = fontSize + "px";
              label.style.opacity = opacity;
            });
          }

          // Ajustar al cargar
          ajustarTamañoFuente();

          // Ajustar cuando cambia el zoom
          mapObj.on("zoomend", ajustarTamañoFuente);
        }
      });
    </script>
  </body>
</html>
